---
layout: post
title: "JWT token Authentication in Azure Media Services and Dynamic Encryption "
slug: 2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption
---

null
   <p class="meta"><span class="sep">Posted on </span><a href="http://gtrifonov.com/" title="View all posts by admin" rel="author">admin</a></span></span></p>
            <p>Starting from Azure Media Services .NET 4.5 &#xA0;SDK 3.1.0.0 release, Azure Media services team added functionality to use JWT token to restrict delivery of content keys. In this post&#xA0;I&#x2019;d like &#xA0;to demonstrate how to issue JWT token to be used in scenario when you want to stream dynamically encrypted content and content key requests have to be restricted.</p>
<h2>Define who is going to get a content key:</h2>
<p>In solutions utilizing Azure Media Services you can publish media content protected with AES encryption (envelope) or utilizing DRM technology such as Microsoft PlayReady. To play encrypted content, a video player has to obtain the content key in order to decrypt the media asset. .</p>
<p>There are three ways to restrict delivery of content key :</p>
<ul>
<li>Not Restricted.Everyone can request a content key.</li>
<li>IP restricted. Only http callers from specific range of ip addresses getting a key.</li>
<li>Token restricted. Only callers who are passing valid token in Auth header or query string will get a content key.</li>
</ul>
<p>To get a content key that has a token restricted authorization policy, the player has to send a request to Azure Media Key Delivery service with JWT or SWT token. Azure Media Key Delivery service&#xA0;validates that token has been signed with proper key and performs validations of token claims defined in a system by service admin.<br>
Before going into details how to construct a JWT token I wanted to walk through classes which you will be using&#xA0; to select that JWT token authentication enforced by key delivery service.</p>
<pre><a href="http://web.archive.org/web/20170211113544/https://github.com/Azure/azure-sdk-for-media-services/blob/dev/src/net/Client/ContentKeyAuthorization/IContentKeyAuthorizationPolicy.cs&apos;, &apos;IContentKeyAuthorizationPolicy&apos;);" title="IContentKeyAuthorizationPolicy" target="_blank">IContentKeyAuthorizationPolicy</a></pre>
<p>This class act as a container for set of access rules which you define in order to restrict delivery of content key. It has collection <a href="http://web.archive.org/web/20170211113544/https://github.com/Azure/azure-sdk-for-media-services/blob/dev/src/net/Client/ContentKeyAuthorization/IContentKeyAuthorizationPolicyOption.cs&apos;, &apos;IContentKeyAuthorizationPolicyOption&apos;);" title="IContentKeyAuthorizationPolicyOption">IContentKeyAuthorizationPolicyOption</a>&#xA0;you need to define.</p>
<pre><a href="http://web.archive.org/web/20170211113544/https://github.com/Azure/azure-sdk-for-media-services/blob/dev/src/net/Client/ContentKeyAuthorization/IContentKeyAuthorizationPolicyOption.cs&apos;, &apos;IContentKeyAuthorizationPolicyOption&apos;);" title="IContentKeyAuthorizationPolicyOption" target="_blank">IContentKeyAuthorizationPolicyOption</a></pre>
<p>Defines which protocol is used for key delivery</p>
<ul>
<li>BaselineHttp (Use MPEG Baseline HTTP key protocol.)</li>
<li>PlayReadyLicense (Use PlayReady License acquisition protocol)</li>
</ul>
<p>and has&#xA0;&#xA0;<a href="http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.mediaservices.client.contentkeyauthorization.icontentkeyauthorizationpolicyoption.restrictions(v=azure.10).aspx&apos;, &apos;IContentKeyAuthorizationPolicyOption.Restrictions&apos;);">IContentKeyAuthorizationPolicyOption.Restrictions</a> collectionof type&#xA0;ContentKeyAuthorizationPolicyRestriction . These policy restrictions are evaluated by key delivery service in order for a key to be served.</p>
<p><a href="http://msdn.microsoft.com/en-us/library/azure/microsoft.windowsazure.mediaservices.client.contentkeyauthorization.contentkeyauthorizationpolicyrestriction(v=azure.10).aspx&apos;, &apos;IContentKeyAuthorizationPolicyRestriction&apos;);">IContentKeyAuthorizationPolicyRestriction</a></p>
<p>As I mentioned before there are 3 ways content key delivery can be restricted and you can define it&#xA0; by assigning on of values from ContentKeyRestrictionType enum to IContentKeyAuthorizationPolicyRestriction.KeyRestrictionType</p>
<p><script src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/7522a1915cfe646d09a2.js.download"></script><link rel="stylesheet" href="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/embed-21a3be81cf2bf2739e4ce956a8e63e76045b4f9ecd23191256fcb90a5c6a87ef.css"></p><div id="gist17519930" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gistfile1-cs" class="file">
    

  <div class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-gistfile1-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-gistfile1-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">public</span> <span class="pl-k">enum</span> <span class="pl-en">ContentKeyRestrictionType</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-gistfile1-cs-LC2" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-gistfile1-cs-LC3" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-gistfile1-cs-LC4" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// No restrictions.</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-gistfile1-cs-LC5" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;/<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-gistfile1-cs-LC6" class="blob-code blob-code-inner js-file-line">        Open,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-gistfile1-cs-LC7" class="blob-code blob-code-inner js-file-line">        </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-gistfile1-cs-LC8" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-gistfile1-cs-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// Restrict by a token.</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-gistfile1-cs-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;/<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-gistfile1-cs-LC11" class="blob-code blob-code-inner js-file-line">        TokenRestricted,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-gistfile1-cs-LC12" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-gistfile1-cs-LC13" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-gistfile1-cs-LC14" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// Restrict by IP.</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-gistfile1-cs-LC15" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">/// &lt;/<span class="pl-ent">summary</span>&gt;</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-gistfile1-cs-LC16" class="blob-code blob-code-inner js-file-line">        IPRestricted</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-gistfile1-cs-LC17" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/gtrifonov/7522a1915cfe646d09a2/raw/d0381c96f422e5e9671a6ae1d3318c0c0d4df9b1/gistfile1.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/gtrifonov/7522a1915cfe646d09a2#file-gistfile1-cs">gistfile1.cs</a>
        hosted with &#x2764; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
Then based on selected restriction type you need to fill IContentKeyAutorizationPolicyRestriction.Requirements property. For TokenRestricted type you need to instantiate <a href="http://web.archive.org/web/20170211113544/https://github.com/gtrifonov/azure-sdk-for-media-services/blob/dev/src/net/Client/ContentKeyAuthorization/Templates/TokenRestrictionTemplateSerializer.cs&apos;, &apos;TokenRestrictionTemplateSerializer.Serialize&apos;);" title="TokenRestrictionTemplateSerializer">TokenRestrictionTemplateSerializer.Serialize</a> to produce corresponding string value for ContentKeyAuthorizationPolicyRestriction.Requirements . The following code snippet demonstrates how to configure the content key authorization policy, so the key would only be delivered to end users who provide JWT token signed with a symmetric key.&#xA0;It also instructs service that issuer and audience claim of a token should&#xA0;match values defined and saved in Azure Media Key Delivery service. &#xA0;<script src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/09fd2f98cfa4dc0a4a75.js.download"></script><link rel="stylesheet" href="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/embed-21a3be81cf2bf2739e4ce956a8e63e76045b4f9ecd23191256fcb90a5c6a87ef(1).css"><div id="gist17519380" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gistfile1-cs" class="file">
    

  <div class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-gistfile1-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-gistfile1-cs-LC1" class="blob-code blob-code-inner js-file-line"> <span class="pl-c">// Create ContentKeyAuthorizationPolicy             </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-gistfile1-cs-LC2" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">string</span> jwtAuthorizationPolicy = <span class="pl-s"><span class="pl-pds">&quot;</span>JWT Authorization Policy<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-gistfile1-cs-LC3" class="blob-code blob-code-inner js-file-line">  IContentKeyAuthorizationPolicy policy = objCloudMediaContext.ContentKeyAuthorizationPolicies.CreateAsync(jwtAuthorizationPolicy).Result;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-gistfile1-cs-LC4" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-gistfile1-cs-LC5" class="blob-code blob-code-inner js-file-line">  List&lt;ContentKeyAuthorizationPolicyRestriction&gt; restrictions = <span class="pl-k">new</span> List&lt;ContentKeyAuthorizationPolicyRestriction&gt;();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-gistfile1-cs-LC6" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-gistfile1-cs-LC7" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Class is used to represent ContentKeyAuthorizationPolicyRestriction.Requerements</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-gistfile1-cs-LC8" class="blob-code blob-code-inner js-file-line">  TokenRestrictionTemplate restrictionTemplate = <span class="pl-k">new</span> TokenRestrictionTemplate();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-gistfile1-cs-LC9" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-gistfile1-cs-LC10" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Specifies which token format will be used in token reques: TokenType.JWT or TokenType.SWT</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-gistfile1-cs-LC11" class="blob-code blob-code-inner js-file-line">  restrictionTemplate.TokenType = TokenType.JWT;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-gistfile1-cs-LC12" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-gistfile1-cs-LC13" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Instructing that token is signed with assymmetric key </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-gistfile1-cs-LC14" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">var</span> templatex509Certificate2 = <span class="pl-k">new</span> X509Certificate2(<span class="pl-s"><span class="pl-pds">&quot;</span>cer.pfx<span class="pl-pds">&quot;</span></span>, <span class="pl-s"><span class="pl-pds">&quot;</span>certPassword<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-gistfile1-cs-LC15" class="blob-code blob-code-inner js-file-line"> </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-gistfile1-cs-LC16" class="blob-code blob-code-inner js-file-line">  TokenRestrictionTemplate tokenRestrictionTemplate = <span class="pl-k">new</span> TokenRestrictionTemplate();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-gistfile1-cs-LC17" class="blob-code blob-code-inner js-file-line">  tokenRestrictionTemplate.PrimaryVerificationKey = <span class="pl-k">new</span> X509CertTokenVerificationKey(templatex509Certificate2);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-gistfile1-cs-LC18" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-gistfile1-cs-LC19" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Specify that only tokens issued to specific aufience will be valid for content key delivery</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-gistfile1-cs-LC20" class="blob-code blob-code-inner js-file-line">  restrictionTemplate.Audience = <span class="pl-k">new</span> Uri(<span class="pl-s"><span class="pl-pds">&quot;</span>http://myaudience<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-gistfile1-cs-LC21" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-gistfile1-cs-LC22" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Instructing that only tokens issues by specific issuer will be valid for content key delivery</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-gistfile1-cs-LC23" class="blob-code blob-code-inner js-file-line">  restrictionTemplate.Issuer = <span class="pl-k">new</span> Uri(<span class="pl-s"><span class="pl-pds">&quot;</span>http://someIdentityserver<span class="pl-pds">&quot;</span></span>);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-gistfile1-cs-LC24" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-gistfile1-cs-LC25" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-gistfile1-cs-LC26" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Initilizing ContentKeyAuthorizationPolicyRestriction</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-gistfile1-cs-LC27" class="blob-code blob-code-inner js-file-line">  ContentKeyAuthorizationPolicyRestriction restriction = <span class="pl-k">new</span> ContentKeyAuthorizationPolicyRestriction</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-gistfile1-cs-LC28" class="blob-code blob-code-inner js-file-line">  {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-gistfile1-cs-LC29" class="blob-code blob-code-inner js-file-line">      Name = <span class="pl-s"><span class="pl-pds">&quot;</span>Authorization Policy with Token Restriction<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-gistfile1-cs-LC30" class="blob-code blob-code-inner js-file-line">      KeyRestrictionType = (<span class="pl-k">int</span>)ContentKeyRestrictionType.TokenRestricted,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-gistfile1-cs-LC31" class="blob-code blob-code-inner js-file-line">      Requirements = TokenRestrictionTemplateSerializer.Serialize(restrictionTemplate)};</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-gistfile1-cs-LC32" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-gistfile1-cs-LC33" class="blob-code blob-code-inner js-file-line">  restrictions.Add(restriction);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-gistfile1-cs-LC34" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-gistfile1-cs-LC35" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Saving IContentKeyAuthorizationPolicyOption on server so it can be associated with IContentKeyAuthorizationPolicy</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-gistfile1-cs-LC36" class="blob-code blob-code-inner js-file-line">  IContentKeyAuthorizationPolicyOption policyOption = objCloudMediaContext.ContentKeyAuthorizationPolicyOptions.Create(<span class="pl-s"><span class="pl-pds">&quot;</span>myDynamicEncryptionPolicy<span class="pl-pds">&quot;</span></span>, ContentKeyDeliveryType.BaselineHttp, restrictions, String.Empty);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-gistfile1-cs-LC37" class="blob-code blob-code-inner js-file-line">  policy.Options.Add(policyOption);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-gistfile1-cs-LC38" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-gistfile1-cs-LC39" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Saving Policy</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-gistfile1-cs-LC40" class="blob-code blob-code-inner js-file-line">  policy.UpdateAsync();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-gistfile1-cs-LC41" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-gistfile1-cs-LC42" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">// Add IContentKeyAuthorizationPolicy to ContentKey</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-gistfile1-cs-LC43" class="blob-code blob-code-inner js-file-line">  objIContentKey.AuthorizationPolicyId = policy.Id;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-gistfile1-cs-LC44" class="blob-code blob-code-inner js-file-line">  IContentKey IContentKeyUpdated = objIContentKey.UpdateAsync().Result;</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/gtrifonov/09fd2f98cfa4dc0a4a75/raw/962ef97df93fa564111bef294bd578c9c606bc52/gistfile1.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/gtrifonov/09fd2f98cfa4dc0a4a75#file-gistfile1-cs">gistfile1.cs</a>
        hosted with &#x2764; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<p></p>
<h2>Define how media asset will be delivered</h2>
<p>Once we restricted delivery of content key, we have to instruct system how asset will be delivered. In our case we &#xA0;want to use dynamic encryption ,scenario when Azure Media streaming service dynamically encrypt content on a fly. &#xA0;You can read more about difference between dynamic and static encryption in Mingfei Yan post&#xA0;<a href="http://mingfeiy.com/dynamic-encryption-vs-static-encryption-azure-media-services&apos;, &apos;Dynamic Encryption vs. Static Encryption with Azure Media Services&apos;);" title="Permalink to Dynamic Encryption vs. Static Encryption with Azure Media Services" rel="bookmark">Dynamic Encryption vs. Static Encryption with Azure Media Services</a><br>
In order to stream asset with dynamically encrypted you have to &#xA0;create&#xA0;IAssetDeliveryPolicy and associate it with media asset.</p>
<p><script src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/8ad4bc517c8685e77ed6.js.download"></script><link rel="stylesheet" href="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/embed-21a3be81cf2bf2739e4ce956a8e63e76045b4f9ecd23191256fcb90a5c6a87ef(2).css"></p><div id="gist17722258" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gistfile1-cs" class="file">
    

  <div class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-gistfile1-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-gistfile1-cs-LC1" class="blob-code blob-code-inner js-file-line">IAssetDeliveryPolicy assetDeliveryPolicy =</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-gistfile1-cs-LC2" class="blob-code blob-code-inner js-file-line">cloudMediaContext.AssetDeliveryPolicies.Create(</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-gistfile1-cs-LC3" class="blob-code blob-code-inner js-file-line">            <span class="pl-s"><span class="pl-pds">&quot;</span>myAssetDeliveryPolicy<span class="pl-pds">&quot;</span></span>,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-gistfile1-cs-LC4" class="blob-code blob-code-inner js-file-line">            AssetDeliveryPolicyType.DynamicEnvelopeEncryption,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-gistfile1-cs-LC5" class="blob-code blob-code-inner js-file-line">            AssetDeliveryProtocol.SmoothStreaming | AssetDeliveryProtocol.HLS,</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-gistfile1-cs-LC6" class="blob-code blob-code-inner js-file-line">            assetDeliveryPolicyConfiguration);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-gistfile1-cs-LC7" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-gistfile1-cs-LC8" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// Add AssetDelivery Policy to the asset</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-gistfile1-cs-LC9" class="blob-code blob-code-inner js-file-line">asset.DeliveryPolicies.Add(assetDeliveryPolicy);</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/gtrifonov/8ad4bc517c8685e77ed6/raw/75b50ebb9a77caa8d4553c6a135b680bac37bba0/gistfile1.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/gtrifonov/8ad4bc517c8685e77ed6#file-gistfile1-cs">gistfile1.cs</a>
        hosted with &#x2764; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<p></p>
<h2>Issuing a JWT token and calling Azure Media Key Delivery Service</h2>
<p>To issue a JWT token you can utilize <a href="http://web.archive.org/web/20170211113544/https://www.nuget.org/packages/System.IdentityModel.Tokens.Jwt/&apos;);" title="https://www.nuget.org/packages/System.IdentityModel.Tokens.Jwt/">https://www.nuget.org/packages/System.IdentityModel.Tokens.Jwt/</a> package in your project.<script src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/8fc4658eecd40a4c66ac.js.download"></script><link rel="stylesheet" href="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/embed-21a3be81cf2bf2739e4ce956a8e63e76045b4f9ecd23191256fcb90a5c6a87ef(3).css"></p><div id="gist17521179" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gistfile1-cs" class="file">
    

  <div class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-gistfile1-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-gistfile1-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">//Issuing a token with values from template we created earlier</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-gistfile1-cs-LC2" class="blob-code blob-code-inner js-file-line">  JwtSecurityToken token = <span class="pl-k">new</span> JwtSecurityToken(issuer: <span class="pl-s"><span class="pl-pds">&quot;</span>http://sampleIssuerUrl/<span class="pl-pds">&quot;</span></span>, audience: <span class="pl-s"><span class="pl-pds">&quot;</span>http://sampleAudience<span class="pl-pds">&quot;</span></span>, notBefore: DateTime.Now.AddMinutes(-<span class="pl-c1">1</span>), expires: DateTime.Now.AddMinutes(<span class="pl-c1">5</span>), signingCredentials: cred);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-gistfile1-cs-LC3" class="blob-code blob-code-inner js-file-line">  JwtSecurityTokenHandler handler = <span class="pl-k">new</span> JwtSecurityTokenHandler();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-gistfile1-cs-LC4" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">string</span> jwtTokenString = handler.WriteToken(token);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-gistfile1-cs-LC5" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-gistfile1-cs-LC6" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Obtaining Url from of KeyDelivery Service where we need to request content key</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-gistfile1-cs-LC7" class="blob-code blob-code-inner js-file-line">  contentKey = _mediaContext.ContentKeys.Where(c =&gt; c.Name == <span class="pl-s"><span class="pl-pds">&quot;</span>MySecretKeytoDecryptMovie<span class="pl-pds">&quot;</span></span>).First();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-gistfile1-cs-LC8" class="blob-code blob-code-inner js-file-line">  Uri keyDeliveryServiceUri = contentKey.GetKeyDeliveryUrl(ContentKeyDeliveryType.BaselineHttp);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-gistfile1-cs-LC9" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-gistfile1-cs-LC10" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Adding Auth header to content key request </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-gistfile1-cs-LC11" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">var</span> kdClient = <span class="pl-k">new</span> HttpClient();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-gistfile1-cs-LC12" class="blob-code blob-code-inner js-file-line">  kdClient.DefaultRequestHeaders.Authorization = <span class="pl-k">new</span> AuthenticationHeaderValue(<span class="pl-s"><span class="pl-pds">&quot;</span>Bearer<span class="pl-pds">&quot;</span></span>, jwtTokenString);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-gistfile1-cs-LC13" class="blob-code blob-code-inner js-file-line">  </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-gistfile1-cs-LC14" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Sending Post request</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-gistfile1-cs-LC15" class="blob-code blob-code-inner js-file-line">  HttpResponseMessage response = kdClient.PostAsync(keyDeliveryServiceUri, <span class="pl-k">new</span> StringContent(<span class="pl-k">string</span>.Empty)).Result;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-gistfile1-cs-LC16" class="blob-code blob-code-inner js-file-line">   response.EnsureSuccessStatusCode();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-gistfile1-cs-LC17" class="blob-code blob-code-inner js-file-line">  <span class="pl-c">//Reading HLS content key</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-gistfile1-cs-LC18" class="blob-code blob-code-inner js-file-line">  <span class="pl-k">byte</span>[] hlsContentKey = response.Content.ReadAsStreamAsync().ContinueWith(t =&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-gistfile1-cs-LC19" class="blob-code blob-code-inner js-file-line">  {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-gistfile1-cs-LC20" class="blob-code blob-code-inner js-file-line">      Stream stream = t.Result;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-gistfile1-cs-LC21" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">var</span> bytes = <span class="pl-k">new</span> <span class="pl-k">byte</span>[stream.Length];</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-gistfile1-cs-LC22" class="blob-code blob-code-inner js-file-line">      stream.Read(bytes, <span class="pl-c1">0</span>, (<span class="pl-k">int</span>)stream.Length);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-gistfile1-cs-LC23" class="blob-code blob-code-inner js-file-line">      <span class="pl-k">return</span> bytes;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-gistfile1-cs-LC24" class="blob-code blob-code-inner js-file-line">  }).Result;</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/gtrifonov/8fc4658eecd40a4c66ac/raw/c6b48b8401782b3213cd88a15566094e4992c425/gistfile1.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/gtrifonov/8fc4658eecd40a4c66ac#file-gistfile1-cs">gistfile1.cs</a>
        hosted with &#x2764; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
Please note that in code snippet above i used a HttpClient to demo a call to a key delivery service. For a player to be able to stream assets encrypted with content keys that have a token restricted authorization policy, the player must be able to work with Auth headers in order to send key requests or to append JWT token as a url parameter: &amp;token=jwttokenValue<p></p>
<h2>Using a JWT token within a video player</h2>
<p>Once you generated a jwt token you can specify it as parameter for a player. For example below i am using<a href="http://azure.microsoft.com/en-us/documentation/articles/media-services-use-osmf-smooth-streaming-client-plugin/%20&apos;, &apos; Strobe Media Playback with the SS ODMF Dynamic Plugin&apos;);" target="_blank"> Strobe Media Playback with the SS ODMF Dynamic Plugin</a>&#xA0;to specify JWT token as one of flash variables. Code snippet looping through Model containing list of Assets and inserting JWT token stored in current user principal claim named&#xA0;&#x201C;AMSAccessToken&#x201D;<script src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/09aca4b1e4302d16da73.js.download"></script><link rel="stylesheet" href="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/embed-21a3be81cf2bf2739e4ce956a8e63e76045b4f9ecd23191256fcb90a5c6a87ef(4).css"></p><div id="gist17522143" class="gist">
    <div class="gist-file">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-gistfile1-cs" class="file">
    

  <div class="blob-wrapper data type-c">
      <table class="highlight tab-size js-file-line-container" data-tab-size="8">
      <tbody><tr>
        <td id="file-gistfile1-cs-L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="file-gistfile1-cs-LC1" class="blob-code blob-code-inner js-file-line"> @model IEnumerable&lt;Tuple&lt;Microsoft.WindowsAzure.MediaServices.Client.IAsset, Microsoft.WindowsAzure.MediaServices.Client.ILocator, Uri&gt;&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L2" class="blob-num js-line-number" data-line-number="2"></td>
        <td id="file-gistfile1-cs-LC2" class="blob-code blob-code-inner js-file-line"> </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L3" class="blob-num js-line-number" data-line-number="3"></td>
        <td id="file-gistfile1-cs-LC3" class="blob-code blob-code-inner js-file-line"> @foreach (<span class="pl-k">var</span> i <span class="pl-k">in</span> Model)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L4" class="blob-num js-line-number" data-line-number="4"></td>
        <td id="file-gistfile1-cs-LC4" class="blob-code blob-code-inner js-file-line">    {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L5" class="blob-num js-line-number" data-line-number="5"></td>
        <td id="file-gistfile1-cs-LC5" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L6" class="blob-num js-line-number" data-line-number="6"></td>
        <td id="file-gistfile1-cs-LC6" class="blob-code blob-code-inner js-file-line">        &lt;tr&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L7" class="blob-num js-line-number" data-line-number="7"></td>
        <td id="file-gistfile1-cs-LC7" class="blob-code blob-code-inner js-file-line">            &lt;td&gt; @i.Item1.Id&lt;/td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L8" class="blob-num js-line-number" data-line-number="8"></td>
        <td id="file-gistfile1-cs-LC8" class="blob-code blob-code-inner js-file-line">            &lt;td&gt; @i.Item1.Name&lt;/td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L9" class="blob-num js-line-number" data-line-number="9"></td>
        <td id="file-gistfile1-cs-LC9" class="blob-code blob-code-inner js-file-line">            @if (i.Item2 != <span class="pl-c1">null</span>)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L10" class="blob-num js-line-number" data-line-number="10"></td>
        <td id="file-gistfile1-cs-LC10" class="blob-code blob-code-inner js-file-line">            {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L11" class="blob-num js-line-number" data-line-number="11"></td>
        <td id="file-gistfile1-cs-LC11" class="blob-code blob-code-inner js-file-line">                &lt;td&gt; @(i.Item2.ExpirationDateTime)&lt;/td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L12" class="blob-num js-line-number" data-line-number="12"></td>
        <td id="file-gistfile1-cs-LC12" class="blob-code blob-code-inner js-file-line">                &lt;td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L13" class="blob-num js-line-number" data-line-number="13"></td>
        <td id="file-gistfile1-cs-LC13" class="blob-code blob-code-inner js-file-line">                    &lt;div&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L14" class="blob-num js-line-number" data-line-number="14"></td>
        <td id="file-gistfile1-cs-LC14" class="blob-code blob-code-inner js-file-line">                        &lt;<span class="pl-k">object</span> width=<span class="pl-s"><span class="pl-pds">&quot;</span>600<span class="pl-pds">&quot;</span></span> height=<span class="pl-s"><span class="pl-pds">&quot;</span>420<span class="pl-pds">&quot;</span></span>&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L15" class="blob-num js-line-number" data-line-number="15"></td>
        <td id="file-gistfile1-cs-LC15" class="blob-code blob-code-inner js-file-line">                            &lt;param name=<span class="pl-s"><span class="pl-pds">&quot;</span>movie<span class="pl-pds">&quot;</span></span> <span class="pl-k">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>@(Url.Content(<span class="pl-pds">&quot;</span></span>~/Content/StrobeMediaPlayback<span class="pl-c1">.2.0</span>.swf<span class="pl-s"><span class="pl-pds">&quot;</span>))<span class="pl-pds">&quot;</span></span>&gt;&lt;/param&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L16" class="blob-num js-line-number" data-line-number="16"></td>
        <td id="file-gistfile1-cs-LC16" class="blob-code blob-code-inner js-file-line">                            &lt;param name=<span class="pl-s"><span class="pl-pds">&quot;</span>flashvars<span class="pl-pds">&quot;</span></span> <span class="pl-k">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>src=@(i.Item3)/Manifest&amp;autoPlay=false&amp;plugin_AdaptiveStreamingPlugin=/Content/MSAdaptiveStreamingPlugin-v1.0.12-osmf2.0.swf&amp;AdaptiveStreamingPlugin_retryLive=true&amp;AdaptiveStreamingPlugin_retryInterval=10&amp;AdaptiveStreamingPlugin_encryptionKeyToken=Bearer @(ClaimsPrincipal.Current.FindFirst(<span class="pl-pds">&quot;</span></span>ADJwtTokenClaim<span class="pl-s"><span class="pl-pds">&quot;</span>).Value)<span class="pl-pds">&quot;</span></span>&gt;&lt;/param&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L17" class="blob-num js-line-number" data-line-number="17"></td>
        <td id="file-gistfile1-cs-LC17" class="blob-code blob-code-inner js-file-line">                            &lt;param name=<span class="pl-s"><span class="pl-pds">&quot;</span>allowFullScreen<span class="pl-pds">&quot;</span></span> <span class="pl-k">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>true<span class="pl-pds">&quot;</span></span>&gt;&lt;/param&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L18" class="blob-num js-line-number" data-line-number="18"></td>
        <td id="file-gistfile1-cs-LC18" class="blob-code blob-code-inner js-file-line">                            &lt;param name=<span class="pl-s"><span class="pl-pds">&quot;</span>allowscriptaccess<span class="pl-pds">&quot;</span></span> <span class="pl-k">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>always<span class="pl-pds">&quot;</span></span>&gt;&lt;/param&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L19" class="blob-num js-line-number" data-line-number="19"></td>
        <td id="file-gistfile1-cs-LC19" class="blob-code blob-code-inner js-file-line">                            &lt;param name=<span class="pl-s"><span class="pl-pds">&quot;</span>wmode<span class="pl-pds">&quot;</span></span> <span class="pl-k">value</span>=<span class="pl-s"><span class="pl-pds">&quot;</span>direct<span class="pl-pds">&quot;</span></span>&gt;&lt;/param&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L20" class="blob-num js-line-number" data-line-number="20"></td>
        <td id="file-gistfile1-cs-LC20" class="blob-code blob-code-inner js-file-line">                            &lt;embed src=<span class="pl-s"><span class="pl-pds">&quot;</span>@(Url.Content(<span class="pl-pds">&quot;</span></span>~/Content/StrobeMediaPlayback<span class="pl-c1">.2.0</span>.swf<span class="pl-s"><span class="pl-pds">&quot;</span>))<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L21" class="blob-num js-line-number" data-line-number="21"></td>
        <td id="file-gistfile1-cs-LC21" class="blob-code blob-code-inner js-file-line">                                   type=<span class="pl-s"><span class="pl-pds">&quot;</span>application/x-shockwave-flash<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L22" class="blob-num js-line-number" data-line-number="22"></td>
        <td id="file-gistfile1-cs-LC22" class="blob-code blob-code-inner js-file-line">                                   allowscriptaccess=<span class="pl-s"><span class="pl-pds">&quot;</span>always<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L23" class="blob-num js-line-number" data-line-number="23"></td>
        <td id="file-gistfile1-cs-LC23" class="blob-code blob-code-inner js-file-line">                                   allowfullscreen=<span class="pl-s"><span class="pl-pds">&quot;</span>true<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L24" class="blob-num js-line-number" data-line-number="24"></td>
        <td id="file-gistfile1-cs-LC24" class="blob-code blob-code-inner js-file-line">                                   wmode=<span class="pl-s"><span class="pl-pds">&quot;</span>direct<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L25" class="blob-num js-line-number" data-line-number="25"></td>
        <td id="file-gistfile1-cs-LC25" class="blob-code blob-code-inner js-file-line">                                   width=<span class="pl-s"><span class="pl-pds">&quot;</span>600<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L26" class="blob-num js-line-number" data-line-number="26"></td>
        <td id="file-gistfile1-cs-LC26" class="blob-code blob-code-inner js-file-line">                                   height=<span class="pl-s"><span class="pl-pds">&quot;</span>420<span class="pl-pds">&quot;</span></span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L27" class="blob-num js-line-number" data-line-number="27"></td>
        <td id="file-gistfile1-cs-LC27" class="blob-code blob-code-inner js-file-line">                                   flashvars=<span class="pl-s"><span class="pl-pds">&quot;</span>src=@(i.Item3)/Manifest&amp;autoPlay=false&amp;plugin_AdaptiveStreamingPlugin=/Content/MSAdaptiveStreamingPlugin-v1.0.12-osmf2.0.swf&amp;AdaptiveStreamingPlugin_retryLive=true&amp;AdaptiveStreamingPlugin_retryInterval=10&amp;AdaptiveStreamingPlugin_encryptionKeyToken=Bearer @(ClaimsPrincipal.Current.FindFirst(<span class="pl-pds">&quot;</span></span>ADJwtTokenClaim<span class="pl-s"><span class="pl-pds">&quot;</span>).Value)<span class="pl-pds">&quot;</span></span>&gt;&lt;/embed&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L28" class="blob-num js-line-number" data-line-number="28"></td>
        <td id="file-gistfile1-cs-LC28" class="blob-code blob-code-inner js-file-line">                        &lt;/<span class="pl-k">object</span>&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L29" class="blob-num js-line-number" data-line-number="29"></td>
        <td id="file-gistfile1-cs-LC29" class="blob-code blob-code-inner js-file-line">                    &lt;/div&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L30" class="blob-num js-line-number" data-line-number="30"></td>
        <td id="file-gistfile1-cs-LC30" class="blob-code blob-code-inner js-file-line">                &lt;/td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L31" class="blob-num js-line-number" data-line-number="31"></td>
        <td id="file-gistfile1-cs-LC31" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L32" class="blob-num js-line-number" data-line-number="32"></td>
        <td id="file-gistfile1-cs-LC32" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">else</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L33" class="blob-num js-line-number" data-line-number="33"></td>
        <td id="file-gistfile1-cs-LC33" class="blob-code blob-code-inner js-file-line">            {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L34" class="blob-num js-line-number" data-line-number="34"></td>
        <td id="file-gistfile1-cs-LC34" class="blob-code blob-code-inner js-file-line">                &lt;td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L35" class="blob-num js-line-number" data-line-number="35"></td>
        <td id="file-gistfile1-cs-LC35" class="blob-code blob-code-inner js-file-line">                    Asset <span class="pl-k">is</span> not streamable </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L36" class="blob-num js-line-number" data-line-number="36"></td>
        <td id="file-gistfile1-cs-LC36" class="blob-code blob-code-inner js-file-line">                &lt;/td&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L37" class="blob-num js-line-number" data-line-number="37"></td>
        <td id="file-gistfile1-cs-LC37" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L38" class="blob-num js-line-number" data-line-number="38"></td>
        <td id="file-gistfile1-cs-LC38" class="blob-code blob-code-inner js-file-line">        &lt;/tr&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L39" class="blob-num js-line-number" data-line-number="39"></td>
        <td id="file-gistfile1-cs-LC39" class="blob-code blob-code-inner js-file-line">    }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L40" class="blob-num js-line-number" data-line-number="40"></td>
        <td id="file-gistfile1-cs-LC40" class="blob-code blob-code-inner js-file-line">    </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L41" class="blob-num js-line-number" data-line-number="41"></td>
        <td id="file-gistfile1-cs-LC41" class="blob-code blob-code-inner js-file-line"> </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L42" class="blob-num js-line-number" data-line-number="42"></td>
        <td id="file-gistfile1-cs-LC42" class="blob-code blob-code-inner js-file-line"> <span class="pl-c">//</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L43" class="blob-num js-line-number" data-line-number="43"></td>
        <td id="file-gistfile1-cs-LC43" class="blob-code blob-code-inner js-file-line">        <span class="pl-c">// GET: Display a list ofstreamable  media assets </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L44" class="blob-num js-line-number" data-line-number="44"></td>
        <td id="file-gistfile1-cs-LC44" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">public</span> <span class="pl-k">async</span> Task&lt;ActionResult&gt; Index()</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L45" class="blob-num js-line-number" data-line-number="45"></td>
        <td id="file-gistfile1-cs-LC45" class="blob-code blob-code-inner js-file-line">        {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L46" class="blob-num js-line-number" data-line-number="46"></td>
        <td id="file-gistfile1-cs-LC46" class="blob-code blob-code-inner js-file-line">            <span class="pl-c">//Initlizing a model</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L47" class="blob-num js-line-number" data-line-number="47"></td>
        <td id="file-gistfile1-cs-LC47" class="blob-code blob-code-inner js-file-line">            List&lt;Tuple&lt;IAsset, ILocator,Uri&gt;&gt; itemList = <span class="pl-k">new</span> List&lt;Tuple&lt;IAsset, ILocator,Uri&gt;&gt;();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L48" class="blob-num js-line-number" data-line-number="48"></td>
        <td id="file-gistfile1-cs-LC48" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L49" class="blob-num js-line-number" data-line-number="49"></td>
        <td id="file-gistfile1-cs-LC49" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">try</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L50" class="blob-num js-line-number" data-line-number="50"></td>
        <td id="file-gistfile1-cs-LC50" class="blob-code blob-code-inner js-file-line">            {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L51" class="blob-num js-line-number" data-line-number="51"></td>
        <td id="file-gistfile1-cs-LC51" class="blob-code blob-code-inner js-file-line">                <span class="pl-c">//Getting credentials to work with Azure Media Services </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L52" class="blob-num js-line-number" data-line-number="52"></td>
        <td id="file-gistfile1-cs-LC52" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">var</span> amsAccessToken = ClaimsPrincipal.Current.FindFirst(<span class="pl-s"><span class="pl-pds">&quot;</span>AMSAccessToken<span class="pl-pds">&quot;</span></span>).Value;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L53" class="blob-num js-line-number" data-line-number="53"></td>
        <td id="file-gistfile1-cs-LC53" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">var</span> amsCredentials = <span class="pl-k">new</span> MediaServicesCredentials(mediaAccount, mediaKey);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L54" class="blob-num js-line-number" data-line-number="54"></td>
        <td id="file-gistfile1-cs-LC54" class="blob-code blob-code-inner js-file-line">                amsCredentials.AccessToken = amsAccessToken;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L55" class="blob-num js-line-number" data-line-number="55"></td>
        <td id="file-gistfile1-cs-LC55" class="blob-code blob-code-inner js-file-line">                CloudMediaContext cntx = <span class="pl-k">new</span> CloudMediaContext(amsCredentials);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L56" class="blob-num js-line-number" data-line-number="56"></td>
        <td id="file-gistfile1-cs-LC56" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L57" class="blob-num js-line-number" data-line-number="57"></td>
        <td id="file-gistfile1-cs-LC57" class="blob-code blob-code-inner js-file-line">                <span class="pl-c">// Find 30-day read-only access policy. </span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L58" class="blob-num js-line-number" data-line-number="58"></td>
        <td id="file-gistfile1-cs-LC58" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">string</span> streamingPolicy = <span class="pl-s"><span class="pl-pds">&quot;</span>30d Streaming policy<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L59" class="blob-num js-line-number" data-line-number="59"></td>
        <td id="file-gistfile1-cs-LC59" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">var</span> accessPolicy = cntx.AccessPolicies.Where(c =&gt; c.Name == streamingPolicy).FirstOrDefault();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L60" class="blob-num js-line-number" data-line-number="60"></td>
        <td id="file-gistfile1-cs-LC60" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L61" class="blob-num js-line-number" data-line-number="61"></td>
        <td id="file-gistfile1-cs-LC61" class="blob-code blob-code-inner js-file-line">                <span class="pl-c">//Locate all files with smooth streaming Manifest</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L62" class="blob-num js-line-number" data-line-number="62"></td>
        <td id="file-gistfile1-cs-LC62" class="blob-code blob-code-inner js-file-line">                cntx.Files.Where(c =&gt; c.Name.EndsWith(<span class="pl-s"><span class="pl-pds">&quot;</span>.ism<span class="pl-pds">&quot;</span></span>)).ForEach(file =&gt;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L63" class="blob-num js-line-number" data-line-number="63"></td>
        <td id="file-gistfile1-cs-LC63" class="blob-code blob-code-inner js-file-line">                </td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L64" class="blob-num js-line-number" data-line-number="64"></td>
        <td id="file-gistfile1-cs-LC64" class="blob-code blob-code-inner js-file-line">                {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L65" class="blob-num js-line-number" data-line-number="65"></td>
        <td id="file-gistfile1-cs-LC65" class="blob-code blob-code-inner js-file-line">                    <span class="pl-c">//skip all assets where DynamicEncryption can&apos;t be applied</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L66" class="blob-num js-line-number" data-line-number="66"></td>
        <td id="file-gistfile1-cs-LC66" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">if</span> (file.Asset.Options != AssetCreationOptions.None)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L67" class="blob-num js-line-number" data-line-number="67"></td>
        <td id="file-gistfile1-cs-LC67" class="blob-code blob-code-inner js-file-line">                    {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L68" class="blob-num js-line-number" data-line-number="68"></td>
        <td id="file-gistfile1-cs-LC68" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">return</span>;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L69" class="blob-num js-line-number" data-line-number="69"></td>
        <td id="file-gistfile1-cs-LC69" class="blob-code blob-code-inner js-file-line">                    }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L70" class="blob-num js-line-number" data-line-number="70"></td>
        <td id="file-gistfile1-cs-LC70" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L71" class="blob-num js-line-number" data-line-number="71"></td>
        <td id="file-gistfile1-cs-LC71" class="blob-code blob-code-inner js-file-line">                    ILocator originLocator = <span class="pl-c1">null</span>;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L72" class="blob-num js-line-number" data-line-number="72"></td>
        <td id="file-gistfile1-cs-LC72" class="blob-code blob-code-inner js-file-line">                    <span class="pl-c">//Display only assets which associated with streaming 30 day policy</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L73" class="blob-num js-line-number" data-line-number="73"></td>
        <td id="file-gistfile1-cs-LC73" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">if</span> (accessPolicy != <span class="pl-c1">null</span>)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L74" class="blob-num js-line-number" data-line-number="74"></td>
        <td id="file-gistfile1-cs-LC74" class="blob-code blob-code-inner js-file-line">                    {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L75" class="blob-num js-line-number" data-line-number="75"></td>
        <td id="file-gistfile1-cs-LC75" class="blob-code blob-code-inner js-file-line">                        originLocator =</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L76" class="blob-num js-line-number" data-line-number="76"></td>
        <td id="file-gistfile1-cs-LC76" class="blob-code blob-code-inner js-file-line">                            file.Asset.Locators.Where(</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L77" class="blob-num js-line-number" data-line-number="77"></td>
        <td id="file-gistfile1-cs-LC77" class="blob-code blob-code-inner js-file-line">                                c =&gt; c.AccessPolicyId == accessPolicy.Id &amp;&amp; c.Type == LocatorType.OnDemandOrigin)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L78" class="blob-num js-line-number" data-line-number="78"></td>
        <td id="file-gistfile1-cs-LC78" class="blob-code blob-code-inner js-file-line">                                .FirstOrDefault();</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L79" class="blob-num js-line-number" data-line-number="79"></td>
        <td id="file-gistfile1-cs-LC79" class="blob-code blob-code-inner js-file-line">                    }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L80" class="blob-num js-line-number" data-line-number="80"></td>
        <td id="file-gistfile1-cs-LC80" class="blob-code blob-code-inner js-file-line">                    <span class="pl-c">//If no policy has been found we are storing nulls in a model</span></td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L81" class="blob-num js-line-number" data-line-number="81"></td>
        <td id="file-gistfile1-cs-LC81" class="blob-code blob-code-inner js-file-line">                    Tuple&lt;IAsset, ILocator, Uri&gt; item = <span class="pl-k">new</span> Tuple&lt;IAsset, ILocator, Uri&gt;(file.Asset, originLocator, originLocator != <span class="pl-c1">null</span> ? <span class="pl-k">new</span> Uri(originLocator.Path + file.Name) : <span class="pl-c1">null</span>);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L82" class="blob-num js-line-number" data-line-number="82"></td>
        <td id="file-gistfile1-cs-LC82" class="blob-code blob-code-inner js-file-line">                    itemList.Add(item);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L83" class="blob-num js-line-number" data-line-number="83"></td>
        <td id="file-gistfile1-cs-LC83" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L84" class="blob-num js-line-number" data-line-number="84"></td>
        <td id="file-gistfile1-cs-LC84" class="blob-code blob-code-inner js-file-line">                });</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L85" class="blob-num js-line-number" data-line-number="85"></td>
        <td id="file-gistfile1-cs-LC85" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L86" class="blob-num js-line-number" data-line-number="86"></td>
        <td id="file-gistfile1-cs-LC86" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">return</span> View(itemList);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L87" class="blob-num js-line-number" data-line-number="87"></td>
        <td id="file-gistfile1-cs-LC87" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L88" class="blob-num js-line-number" data-line-number="88"></td>
        <td id="file-gistfile1-cs-LC88" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">catch</span> (Exception)</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L89" class="blob-num js-line-number" data-line-number="89"></td>
        <td id="file-gistfile1-cs-LC89" class="blob-code blob-code-inner js-file-line">            {</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L90" class="blob-num js-line-number" data-line-number="90"></td>
        <td id="file-gistfile1-cs-LC90" class="blob-code blob-code-inner js-file-line">
</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L91" class="blob-num js-line-number" data-line-number="91"></td>
        <td id="file-gistfile1-cs-LC91" class="blob-code blob-code-inner js-file-line">                ViewBag.ErrorMessage = <span class="pl-s"><span class="pl-pds">&quot;</span>AuthorizationRequired<span class="pl-pds">&quot;</span></span>;</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L92" class="blob-num js-line-number" data-line-number="92"></td>
        <td id="file-gistfile1-cs-LC92" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">return</span> View(itemList);</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L93" class="blob-num js-line-number" data-line-number="93"></td>
        <td id="file-gistfile1-cs-LC93" class="blob-code blob-code-inner js-file-line">            }</td>
      </tr>
      <tr>
        <td id="file-gistfile1-cs-L94" class="blob-num js-line-number" data-line-number="94"></td>
        <td id="file-gistfile1-cs-LC94" class="blob-code blob-code-inner js-file-line">        }</td>
      </tr>
</tbody></table>

  </div>

  </div>
  
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/gtrifonov/09aca4b1e4302d16da73/raw/bff9253e22d036eca3efaa4cfd4f7d4e9e64aa2a/gistfile1.cs" style="float:right">view raw</a>
        <a href="https://gist.github.com/gtrifonov/09aca4b1e4302d16da73#file-gistfile1-cs">gistfile1.cs</a>
        hosted with &#x2764; by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
<p></p>
<p>In a next blog post i will demo how to utilize Azure Active Directory to have role based access to your Azure Media services streamable content within OWIN based MVC App.</p>
<div style="float: right; margin-left: 10px;"><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" title="Twitter Tweet Button" src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/tweet_button.b8b8e09be0884a395c5ae18831ce1cc0.en.html" style="position: absolute; visibility: hidden; width: 0px; height: 0px;" data-url="http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/"></iframe><script type="text/javascript" src="./-2015-01-03-jwt-token-authentication-in-azure-media-services-and-dynamic-encryption-_files/widgets.js.download"></script></div>            <p>Tags: <a href="http://gtrifonov.com/tag/key-delivery/" rel="tag">Key Delivery</a></p><hr>
 
